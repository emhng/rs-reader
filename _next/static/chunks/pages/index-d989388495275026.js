(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(1047)}])},1047:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var l=s(5893),a=s(9008),n=s.n(a),r=s(7294);let i=async(e,t,s,l,a)=>{let[n,r,i]=e;try{let c="https://reader-api.fly.dev/v1/"+t+"/last50";!0===s&&(c="https://reader-api.fly.dev/v1/"+t),!0===l&&(c="https://reader-api.fly.dev/v1/"+t+"/new/"+a);let d=await fetch(c,{mode:"cors"});if(!d.ok)switch(d.status){case 429:throw Error("429 アクセス過多。15分ほど経ったらまたアクセスしてください。");case 404:throw Error("404 このスレが存在しません。削除されたかURLが間違ってます。");case 500:throw Error("500 API側に問題が発生しました。");default:throw Error("".concat(d.status))}let h=await d.json();if(h.status&&"200"!==h.status||0===Object.keys(h).length){if(0===Object.keys(h).length||"404"===h.status)throw Error("404 このスレが存在しません。削除されたかURLが間違ってます");throw Error(h.message)}r(h)}catch(o){o instanceof Error&&i(o.message)}finally{n(!1)}};var c=s(8145),d=s(4276),h=s(6484),o=s(5456),u=s(3250),f=s(7800),x=s(1163);let p=e=>{let{title:t,threadUrl:s,threadId:a,postsData:n,isReading:d,setIsReading:h}=e,u=(0,x.useRouter)(),[p,j]=(0,r.useState)(!1),[m,v]=(0,r.useState)(!1),[g,S]=(0,r.useState)(!0),[N,w]=(0,r.useState)(null),[E,I]=(0,r.useState)([]),[b,k]=(0,r.useState)(null),[y,U]=(0,r.useState)(""),[C,_]=(0,r.useState)([]);(0,r.useEffect)(()=>{d&&window.scrollTo({top:0})},[d,b,E]),(0,r.useEffect)(()=>{if(n){let e=n[n.length-1].postId;U("#"+s+"/"+e);let t=n.map((e,t)=>(0,l.jsxs)("div",{className:"post hflex",id:s+"/"+e.postId,children:[(0,l.jsx)("div",{className:"post-id hflex",children:(0,l.jsx)("p",{children:e.postId})}),(0,l.jsxs)("div",{className:"post-info",children:[(0,l.jsxs)("div",{className:"hflex post-header",children:[(0,l.jsx)("p",{children:e.name}),(0,l.jsx)("p",{children:e.date}),(0,l.jsx)("p",{children:e.time}),(0,l.jsx)("p",{children:e.userId})]}),(0,l.jsx)("p",{className:"message",children:e.message})]})]},t));_(t)}},[n]);let z=()=>{u.push("/"),d&&h(!1)},Z=e=>{e.stopPropagation()},F=()=>{j(!0)},O=()=>{v(!0)};return(0,r.useEffect)(()=>{let e=[S,k,w];if(p&&(i(e,a,!0),j(!1)),m){let t;if(b){let s=b.posts;t=s[s.length-1].postId}else t=n[n.length-1].postId;i(e,a,!1,!0,t),v(!1)}},[p,m]),(0,r.useEffect)(()=>{if(N){let e=(0,l.jsxs)("h3",{className:N?"error hflex icon-gap vertical-center":"hidden",children:[(0,l.jsx)(c.Z,{size:32,weight:"duotone"}),N]});I([e])}},[N]),(0,r.useEffect)(()=>{if(b){w(null);let e=b.posts,t=e[e.length-1].postId;U("#"+s+"/"+t);let a=e.map((e,t)=>(0,l.jsxs)("div",{className:"post hflex",id:s+"/"+e.postId,children:[(0,l.jsx)("div",{className:"post-id hflex",children:(0,l.jsx)("p",{children:e.postId})}),(0,l.jsxs)("div",{className:"post-info",children:[(0,l.jsxs)("div",{className:"hflex post-header",children:[(0,l.jsx)("p",{children:e.name}),(0,l.jsx)("p",{children:e.date}),(0,l.jsx)("p",{children:e.time}),(0,l.jsx)("p",{children:e.userId})]}),(0,l.jsx)("p",{className:"message",children:e.message})]})]},t));_(a)}},[b]),(0,l.jsx)("div",{className:d?"modal-background":"hidden",onClick:z,children:(0,l.jsxs)("div",{className:"modal",onClick:Z,children:[(0,l.jsx)("header",{className:"",children:(0,l.jsxs)("div",{className:"header-cont",children:[(0,l.jsxs)("div",{className:"hflex space-btwn vertical-center title-cont",children:[(0,l.jsx)("h2",{children:t}),(0,l.jsx)("button",{className:"close hflex vertical-center",onClick:z,children:(0,l.jsx)(f.Z,{size:20})})]}),(0,l.jsxs)("div",{className:"hflex space-btwn vertical-center wrap-rev page-control-cont",children:[(0,l.jsxs)("div",{className:"page-controls hflex",children:[(0,l.jsx)("button",{onClick:F,children:"全部"}),(0,l.jsx)("a",{href:y,children:(0,l.jsx)("button",{children:"最後のレスへ飛ぶ"})}),(0,l.jsx)("button",{onClick:O,children:"新着"})]}),(0,l.jsxs)("p",{className:"hflex icon-gap vertical-center",children:[(0,l.jsx)(o.Z,{size:20})," ",s]})]})]})}),(0,l.jsx)("main",{className:"thread-cont",children:(0,l.jsx)("section",{className:"posts",children:N?E:C})})]})})},j=()=>{let e=function(e,t){localStorage.setItem(e,JSON.stringify(t))},t=function(e){let t=localStorage.getItem(e);if(null===t)return null;{let s=JSON.parse(t);return s}},s=function(s,l){{let a=t(s);return null===a?(e(s,l),l):a}},l=function(e){localStorage.removeItem(e)};return{set:e,get:t,getSavedState:s,remove:l}},m=e=>{let{threadId:t,deleteStateFn:s,lastUpdateStateFn:a}=e,n=j(),[f,x]=(0,r.useState)(!1),[m,v]=(0,r.useState)(null),[g,S]=(0,r.useState)(null),[N,w]=(0,r.useState)(!1),[E,I]=(0,r.useState)(null),[b,k]=(0,r.useState)(null),[y,U]=(0,r.useState)(null),[C,_]=(0,r.useState)(null),[z,Z]=(0,r.useState)(null),F="doujin/"+t,[O,D]=(0,r.useState)(!0),[P,R]=(0,r.useState)(null),[A,T]=(0,r.useState)(null),L=[D,R,T],[J,X]=(0,r.useState)("loading");(0,r.useEffect)(()=>{i(L,t)},[]),(0,r.useEffect)(()=>{O&&X("loaded")},[O]),(0,r.useEffect)(()=>{if(P){if(_(P.title),a&&a){let e;let s=void 0===P.lastUpdate;e=s?{id:t,lastUpdate:null}:{id:t,lastUpdate:P.lastUpdate},a(t=>[...t,e])}Z(P.totalCount),U(P.posts)}},[P]),(0,r.useEffect)(()=>{A&&a&&a&&a(e=>[...e,{id:t,lastUpdate:null}])},[A]),(0,r.useEffect)(()=>{if(y){let e=y[y.length-1].date,s=y[y.length-1].time;I(e),k(s);let l=y[y.length-1].postId;l||(l=0),v(l),S(n.getSavedState(t,l))}},[y]),(0,r.useEffect)(()=>{g&&g!==m&&x(!0)},[g]);let q=()=>{(!N&&y&&A||!N&&y&&!A)&&(w(!0),g&&m&&f&&(n.set(t,m),x(!1)))},B=e=>{e.stopPropagation(),s(t)};return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"thread-card",onClick:q,children:[(0,l.jsx)("div",{className:f?"update-bubble":"hidden"}),(0,l.jsxs)("h3",{className:A?"error hflex icon-gap vertical-center":"hidden",children:[(0,l.jsx)(c.Z,{size:32,weight:"duotone"}),A]}),(0,l.jsx)("h1",{children:C}),(0,l.jsxs)("div",{className:"hflex space-btwn baseline thread-info wrap",children:[(0,l.jsxs)("p",{className:"hflex icon-gap vertical-center",children:[(0,l.jsx)(d.Z,{size:20}),(0,l.jsx)("span",{className:"post-count",children:z}),"レス"]}),(0,l.jsxs)("p",{className:"hflex icon-gap vertical-center",children:[(0,l.jsx)(h.Z,{size:20})," ",(0,l.jsx)("span",{children:"更新日時:"}),E," ",b]}),(0,l.jsxs)("p",{className:"hflex icon-gap vertical-center",children:[(0,l.jsx)(o.Z,{size:20})," ",F]}),(0,l.jsx)("button",{className:"delete flex-center",onClick:B,children:(0,l.jsx)(u.Z,{size:20})})]})]}),(0,l.jsx)(p,{title:C,threadUrl:F,threadId:t,postsData:y,isReading:N,setIsReading:w})]},J)};var v=s(5343);function g(){let e=j(),[t,s]=(0,r.useState)(e.getSavedState("threadIdArray","1663333702, 1665938896, 1667015689".split(", "))),[a,i]=(0,r.useState)([]),[c,d]=(0,r.useState)(null),[h,o]=(0,r.useState)(null),[u,f]=(0,r.useState)(!0),[x,p]=(0,r.useState)(null),[g,S]=(0,r.useState)(!1),[N,w]=(0,r.useState)(0),[E,I]=(0,r.useState)([]),[b,k]=(0,r.useState)(!1),[y,U]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(null!==t&&0===a.length&&0!==t.length){let e=t.map(e=>(0,l.jsx)(m,{threadId:e,deleteStateFn:d,lastUpdateStateFn:U},e));i(e)}},[]),(0,r.useEffect)(()=>{if(0===t.length){let e=(0,l.jsx)("div",{className:"empty-state flex-center",children:(0,l.jsx)("h1",{children:"スレを追加しましょう"})},0);I([e])}else I([]);b||6!==t.length||k(!0),b&&t.length<6&&k(!1)},[t,b]),(0,r.useEffect)(()=>{if(y.length===t.length){let e=[...y],s=e.sort((e,t)=>{let s=new Date(e.lastUpdate),l=new Date(t.lastUpdate);return s<l?-1:s>l?1:0}).reverse(),a=s.map(e=>(0,l.jsx)(m,{threadId:e.id,deleteStateFn:d,lastUpdateStateFn:U},e.id));i(a)}},[y]),(0,r.useEffect)(()=>{if(g&&null!==t&&0!==t.length){U([]);let e=t.map(e=>(0,l.jsx)(m,{threadId:e,deleteStateFn:d,lastUpdateStateFn:U},e));i(e),S(!1),w(e=>e+1)}},[g]),(0,r.useEffect)(()=>{if(c){e.remove(c);let l=t.filter(e=>{if(e!==c)return e});s(l),e.set("threadIdArray",l);let n=a.filter(e=>{if(e.props.threadId!==c)return e});i(n)}},[c]);let C=n=>{n.preventDefault();let r=-1===t.indexOf(h);if(r&&t.length<6&&h){s([h,...t]),e.set("threadIdArray",[h,...t]);let c=(0,l.jsx)(m,{threadId:h,deleteStateFn:d},h);i([c,...a]),window.scrollTo({top:0}),x&&p(null)}else 6===t.length?p("スレ数は最大".concat(6,"スレ")):h?p("doujin/"+h+"はすでに登録済み"):p("スレIDが必要");o(null),f(!0)},_=e=>{u&&" "!==e.target.value&&f(!1);let t=e.target.value.trim();o(t)},z=e=>{e.preventDefault(),S(!0)},Z=(0,l.jsxs)("div",{className:"hflex vertical-center wrap add-thread-cont",children:[(0,l.jsxs)("div",{className:x?"error icon-gap hflex vertical-center":"hidden",children:[(0,l.jsx)(v.Z,{size:20}),x]}),(0,l.jsxs)("form",{className:"hflex vertical-center",onSubmit:C,children:[b?(0,l.jsxs)("div",{className:"hflex vertical-center limit-msg",children:["スレ数は最大",6,"スレ"]}):(0,l.jsx)("div",{className:"label-input-cont",children:(0,l.jsxs)("label",{className:"hflex vertical-center",htmlFor:"new-thread",children:[(0,l.jsx)("p",{children:"doujin/"}),(0,l.jsx)("input",{onChange:_,name:"new-thread",id:"new-thread",type:"text",maxLength:10,placeholder:"1663333702",value:h||""})]})}),(0,l.jsx)("button",{className:"add hflex icon-gap vertical-center",disabled:u,children:"スレを追加"})]})]});return(0,l.jsxs)("div",{children:[(0,l.jsxs)(n(),{children:[(0,l.jsx)("title",{children:"rs-reader"}),(0,l.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,l.jsxs)("nav",{className:"hflex space-btwn vertical-center",children:[(0,l.jsx)("a",{href:"/",onClick:z,children:(0,l.jsx)("h1",{children:"rs-reader"})}),Z]}),(0,l.jsxs)("main",{className:"flex-center list",children:[E,a]},N)]})}}},function(e){e.O(0,[213,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);