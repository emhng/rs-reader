(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(1047)}])},1047:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var l=s(5893),a=s(9008),n=s.n(a),r=s(7294);let i=async(e,t,s,l,a)=>{let[n,r,i]=e;try{let c="https://reader-api.fly.dev/v1/"+t+"/last50";!0===s&&(c="https://reader-api.fly.dev/v1/"+t),!0===l&&(c="https://reader-api.fly.dev/v1/"+t+"/new/"+a);let d=await fetch(c,{mode:"cors"});if(!d.ok)switch(d.status){case 429:throw Error("429 アクセス過多。15分ほど経ったらまたアクセスしてください。");case 404:throw Error("404 このスレが存在しません。削除されたかURLが間違ってます。");case 500:throw Error("500 API側に問題が発生しました。");default:throw Error("".concat(d.status))}let h=await d.json();if(h.status&&"200"!==h.status||0===Object.keys(h).length){if(0===Object.keys(h).length||"404"===h.status)throw Error("404 このスレが存在しません。削除されたかURLが間違ってます");throw Error(h.message)}r(h)}catch(o){o instanceof Error&&i(o.message)}finally{n(!1)}};var c=s(8145),d=s(4276),h=s(6484),o=s(5456),u=s(3250),f=s(7800),x=s(1163);let p=e=>{let{title:t,threadUrl:s,threadId:a,postsData:n,isReading:d,setIsReading:h}=e,u=(0,x.useRouter)(),[p,j]=(0,r.useState)(!1),[m,v]=(0,r.useState)(!1),[g,N]=(0,r.useState)(!0),[S,w]=(0,r.useState)(null),[E,I]=(0,r.useState)([]),[b,k]=(0,r.useState)(null),[y,U]=(0,r.useState)(""),[C,_]=(0,r.useState)([]);(0,r.useEffect)(()=>{d&&window.scrollTo({top:0})},[d,b,E]),(0,r.useEffect)(()=>{if(n){let e=n[n.length-1].postId;U("#"+s+"/"+e);let t=n.map((e,t)=>(0,l.jsxs)("div",{className:"post hflex",id:s+"/"+e.postId,children:[(0,l.jsx)("div",{className:"post-id hflex",children:(0,l.jsx)("p",{children:e.postId})}),(0,l.jsxs)("div",{className:"post-info",children:[(0,l.jsxs)("div",{className:"hflex post-header",children:[(0,l.jsx)("p",{children:e.name}),(0,l.jsx)("p",{children:e.date}),(0,l.jsx)("p",{children:e.time}),(0,l.jsx)("p",{children:e.userId})]}),(0,l.jsx)("p",{className:"message",children:e.message})]})]},t));_(t)}},[n]);let z=()=>{u.push("/"),d&&h(!1)},Z=e=>{e.stopPropagation()},F=()=>{j(!0)},O=()=>{v(!0)};return(0,r.useEffect)(()=>{let e=[N,k,w];if(p&&(i(e,a,!0),j(!1)),m){let t;if(b){let s=b.posts;t=s[s.length-1].postId}else t=n[n.length-1].postId;i(e,a,!1,!0,t),v(!1)}},[p,m]),(0,r.useEffect)(()=>{if(S){let e=(0,l.jsxs)("h3",{className:S?"error hflex icon-gap vertical-center":"hidden",children:[(0,l.jsx)(c.Z,{size:32,weight:"duotone"}),S]});I([e])}},[S]),(0,r.useEffect)(()=>{if(b){w(null);let e=b.posts,t=e[e.length-1].postId;U("#"+s+"/"+t);let a=e.map((e,t)=>(0,l.jsxs)("div",{className:"post hflex",id:s+"/"+e.postId,children:[(0,l.jsx)("div",{className:"post-id hflex",children:(0,l.jsx)("p",{children:e.postId})}),(0,l.jsxs)("div",{className:"post-info",children:[(0,l.jsxs)("div",{className:"hflex post-header",children:[(0,l.jsx)("p",{children:e.name}),(0,l.jsx)("p",{children:e.date}),(0,l.jsx)("p",{children:e.time}),(0,l.jsx)("p",{children:e.userId})]}),(0,l.jsx)("p",{className:"message",children:e.message})]})]},t));_(a)}},[b]),(0,l.jsx)("div",{className:d?"modal-background":"hidden",onClick:z,children:(0,l.jsxs)("div",{className:"modal",onClick:Z,children:[(0,l.jsx)("header",{className:"",children:(0,l.jsxs)("div",{className:"header-cont",children:[(0,l.jsxs)("div",{className:"hflex space-btwn baseline title-cont",children:[(0,l.jsx)("h2",{children:t}),(0,l.jsx)("button",{className:"close hflex vertical-center",onClick:z,children:(0,l.jsx)(f.Z,{size:20})})]}),(0,l.jsxs)("div",{className:"hflex space-btwn vertical-center wrap-rev page-control-cont",children:[(0,l.jsxs)("div",{className:"page-controls hflex",children:[(0,l.jsx)("button",{onClick:F,children:"全部"}),(0,l.jsx)("a",{href:y,children:(0,l.jsx)("button",{children:"最後のレスへ飛ぶ"})}),(0,l.jsx)("button",{onClick:O,children:"新着"})]}),(0,l.jsxs)("p",{className:"hflex icon-gap vertical-center",children:[(0,l.jsx)(o.Z,{size:20})," ",s]})]})]})}),(0,l.jsx)("main",{className:"thread-cont",children:(0,l.jsx)("section",{className:"posts",children:S?E:C})})]})})},j=()=>{let e=function(e,t){localStorage.setItem(e,JSON.stringify(t))},t=function(e){let t=localStorage.getItem(e);if(null===t)return null;{let s=JSON.parse(t);return s}},s=function(s,l){{let a=t(s);return null===a?(e(s,l),l):a}},l=function(e){localStorage.removeItem(e)};return{set:e,get:t,getSavedState:s,remove:l}},m=e=>{let{threadId:t,deleteStateFn:s,lastUpdateStateFn:a}=e,n=j(),[f,x]=(0,r.useState)(!1),[m,v]=(0,r.useState)(null),[g,N]=(0,r.useState)(null),[S,w]=(0,r.useState)(!1),[E,I]=(0,r.useState)(null),[b,k]=(0,r.useState)(null),[y,U]=(0,r.useState)(null),[C,_]=(0,r.useState)(null),[z,Z]=(0,r.useState)(null),F="doujin/"+t,[O,D]=(0,r.useState)(!0),[R,P]=(0,r.useState)(null),[A,T]=(0,r.useState)(null),L=[D,P,T],[J,X]=(0,r.useState)("loading");(0,r.useEffect)(()=>{i(L,t)},[]),(0,r.useEffect)(()=>{O&&X("loaded")},[O]),(0,r.useEffect)(()=>{if(R){if(_(R.title),a&&a){let e;let s=void 0===R.lastUpdate;e=s?{id:t,lastUpdate:null}:{id:t,lastUpdate:R.lastUpdate},a(t=>[...t,e])}Z(R.totalCount),U(R.posts)}},[R]),(0,r.useEffect)(()=>{A&&a&&a&&a(e=>[...e,{id:t,lastUpdate:null}])},[A]),(0,r.useEffect)(()=>{if(y){let e=y[y.length-1].date,s=y[y.length-1].time;I(e),k(s);let l=y[y.length-1].postId;l||(l=0),v(l),N(n.getSavedState(t,l))}},[y]),(0,r.useEffect)(()=>{g&&g!==m&&x(!0)},[g]);let q=()=>{(!S&&y&&A||!S&&y&&!A)&&(w(!0),g&&m&&f&&(n.set(t,m),x(!1)))},B=e=>{e.stopPropagation(),s(t)};return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"thread-card",onClick:q,children:[(0,l.jsx)("div",{className:f?"update-bubble":"hidden"}),(0,l.jsxs)("h3",{className:A?"error hflex icon-gap vertical-center":"hidden",children:[(0,l.jsx)(c.Z,{size:32,weight:"duotone"}),A]}),(0,l.jsx)("h1",{children:C}),(0,l.jsxs)("div",{className:"hflex space-btwn baseline thread-info wrap",children:[(0,l.jsxs)("p",{className:"hflex icon-gap vertical-center",children:[(0,l.jsx)(d.Z,{size:20}),(0,l.jsx)("span",{className:"post-count",children:z}),"レス"]}),(0,l.jsxs)("p",{className:"hflex icon-gap vertical-center",children:[(0,l.jsx)(h.Z,{size:20})," ",(0,l.jsx)("span",{children:"更新日時:"}),E," ",b]}),(0,l.jsxs)("p",{className:"hflex icon-gap vertical-center",children:[(0,l.jsx)(o.Z,{size:20})," ",F]}),(0,l.jsx)("button",{className:"delete flex-center",onClick:B,children:(0,l.jsx)(u.Z,{size:20})})]})]}),(0,l.jsx)(p,{title:C,threadUrl:F,threadId:t,postsData:y,isReading:S,setIsReading:w})]},J)};var v=s(5343);function g(){let e=j(),t=(0,x.useRouter)(),[s,a]=(0,r.useState)(e.getSavedState("threadIdArray","1663333702, 1665938896, 1667015689".split(", "))),[i,c]=(0,r.useState)([]),[d,h]=(0,r.useState)(null),[o,u]=(0,r.useState)(null),[f,p]=(0,r.useState)(!0),[g,N]=(0,r.useState)(null),[S,w]=(0,r.useState)(!1),[E,I]=(0,r.useState)(0),[b,k]=(0,r.useState)([]),[y,U]=(0,r.useState)(!1),[C,_]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(null!==s&&0===i.length&&0!==s.length){let e=s.map(e=>(0,l.jsx)(m,{threadId:e,deleteStateFn:h,lastUpdateStateFn:_},e));c(e)}},[]),(0,r.useEffect)(()=>{if(0===s.length){let e=(0,l.jsx)("div",{className:"empty-state flex-center",children:(0,l.jsx)("h1",{children:"スレを追加しましょう"})},0);k([e])}else k([]);y||6!==s.length||U(!0),y&&s.length<6&&U(!1)},[s,y]),(0,r.useEffect)(()=>{if(C.length===s.length){let e=[...C],t=e.sort((e,t)=>{let s=new Date(e.lastUpdate),l=new Date(t.lastUpdate);return s<l?-1:s>l?1:0}).reverse(),a=t.map(e=>(0,l.jsx)(m,{threadId:e.id,deleteStateFn:h,lastUpdateStateFn:_},e.id));c(a)}},[C]),(0,r.useEffect)(()=>{if(S&&null!==s&&0!==s.length){_([]);let e=s.map(e=>(0,l.jsx)(m,{threadId:e,deleteStateFn:h,lastUpdateStateFn:_},e));c(e),w(!1),I(e=>e+1)}},[S]),(0,r.useEffect)(()=>{if(d){e.remove(d);let t=s.filter(e=>{if(e!==d)return e});a(t),e.set("threadIdArray",t);let l=i.filter(e=>{if(e.props.threadId!==d)return e});c(l)}},[d]);let z=t=>{t.preventDefault();let n=-1===s.indexOf(o);if(n&&s.length<6&&o){a([o,...s]),e.set("threadIdArray",[o,...s]);let r=(0,l.jsx)(m,{threadId:o,deleteStateFn:h},o);c([r,...i]),window.scrollTo({top:0}),g&&N(null)}else 6===s.length?N("スレ数は最大".concat(6,"スレ")):o?N("doujin/"+o+"はすでに登録済み"):N("スレIDが必要");u(null),p(!0)},Z=e=>{f&&" "!==e.target.value&&p(!1);let t=e.target.value.trim();u(t)},F=e=>{e.preventDefault(),t.push("/"),w(!0)},O=(0,l.jsxs)("div",{className:"hflex vertical-center wrap add-thread-cont",children:[(0,l.jsxs)("div",{className:g?"error icon-gap hflex vertical-center":"hidden",children:[(0,l.jsx)(v.Z,{size:20}),g]}),(0,l.jsxs)("form",{className:"hflex vertical-center",onSubmit:z,children:[y?(0,l.jsxs)("div",{className:"hflex vertical-center limit-msg",children:["スレ数は最大",6,"スレ"]}):(0,l.jsx)("div",{className:"label-input-cont",children:(0,l.jsxs)("label",{className:"hflex vertical-center",htmlFor:"new-thread",children:[(0,l.jsx)("p",{children:"doujin/"}),(0,l.jsx)("input",{onChange:Z,name:"new-thread",id:"new-thread",type:"text",maxLength:10,placeholder:"1663333702",value:o||""})]})}),(0,l.jsx)("button",{className:"add hflex icon-gap vertical-center",disabled:f,children:"スレを追加"})]})]});return(0,l.jsxs)("div",{children:[(0,l.jsxs)(n(),{children:[(0,l.jsx)("title",{children:"rs-reader"}),(0,l.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,l.jsxs)("nav",{className:"hflex space-btwn vertical-center",children:[(0,l.jsx)("h1",{className:"logo",onClick:F,children:"rs-reader"}),O]}),(0,l.jsxs)("main",{className:"flex-center list",children:[b,i]},E)]})}}},function(e){e.O(0,[213,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);